Defaulting to user installation because normal site-packages is not writeable
ERROR: Invalid requirement: '# Core dependencies for the Discord bot and async operations': Expected package name at the start of dependency specifier
    # Core dependencies for the Discord bot and async operations
    ^
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: discord.py==2.3.2 in ./.local/lib/python3.12/site-packages (2.3.2)
Requirement already satisfied: aiohttp<4,>=3.7.4 in ./.local/lib/python3.12/site-packages (from discord.py==2.3.2) (3.9.5)
Requirement already satisfied: aiosignal>=1.1.2 in ./.local/lib/python3.12/site-packages (from aiohttp<4,>=3.7.4->discord.py==2.3.2) (1.3.2)
Requirement already satisfied: attrs>=17.3.0 in ./.local/lib/python3.12/site-packages (from aiohttp<4,>=3.7.4->discord.py==2.3.2) (25.3.0)
Requirement already satisfied: frozenlist>=1.1.1 in ./.local/lib/python3.12/site-packages (from aiohttp<4,>=3.7.4->discord.py==2.3.2) (1.5.0)
Requirement already satisfied: multidict<7.0,>=4.5 in ./.local/lib/python3.12/site-packages (from aiohttp<4,>=3.7.4->discord.py==2.3.2) (6.2.0)
Requirement already satisfied: yarl<2.0,>=1.0 in ./.local/lib/python3.12/site-packages (from aiohttp<4,>=3.7.4->discord.py==2.3.2) (1.18.3)
Requirement already satisfied: idna>=2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp<4,>=3.7.4->discord.py==2.3.2) (3.10)
Requirement already satisfied: propcache>=0.2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp<4,>=3.7.4->discord.py==2.3.2) (0.3.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: aiohttp==3.9.5 in ./.local/lib/python3.12/site-packages (3.9.5)
Requirement already satisfied: aiosignal>=1.1.2 in ./.local/lib/python3.12/site-packages (from aiohttp==3.9.5) (1.3.2)
Requirement already satisfied: attrs>=17.3.0 in ./.local/lib/python3.12/site-packages (from aiohttp==3.9.5) (25.3.0)
Requirement already satisfied: frozenlist>=1.1.1 in ./.local/lib/python3.12/site-packages (from aiohttp==3.9.5) (1.5.0)
Requirement already satisfied: multidict<7.0,>=4.5 in ./.local/lib/python3.12/site-packages (from aiohttp==3.9.5) (6.2.0)
Requirement already satisfied: yarl<2.0,>=1.0 in ./.local/lib/python3.12/site-packages (from aiohttp==3.9.5) (1.18.3)
Requirement already satisfied: idna>=2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5) (3.10)
Requirement already satisfied: propcache>=0.2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5) (0.3.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: aiomysql==0.2.0 in ./.local/lib/python3.12/site-packages (0.2.0)
Requirement already satisfied: PyMySQL>=1.0 in ./.local/lib/python3.12/site-packages (from aiomysql==0.2.0) (1.1.1)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: redis==5.0.4 in ./.local/lib/python3.12/site-packages (5.0.4)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: cryptography==42.0.5 in ./.local/lib/python3.12/site-packages (42.0.5)
Requirement already satisfied: cffi>=1.12 in ./.local/lib/python3.12/site-packages (from cryptography==42.0.5) (1.17.1)
Requirement already satisfied: pycparser in ./.local/lib/python3.12/site-packages (from cffi>=1.12->cryptography==42.0.5) (2.22)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: aiohttp-session==2.12.0 in ./.local/lib/python3.12/site-packages (2.12.0)
Requirement already satisfied: aiohttp>=3.8 in ./.local/lib/python3.12/site-packages (from aiohttp-session==2.12.0) (3.9.5)
Requirement already satisfied: aiosignal>=1.1.2 in ./.local/lib/python3.12/site-packages (from aiohttp>=3.8->aiohttp-session==2.12.0) (1.3.2)
Requirement already satisfied: attrs>=17.3.0 in ./.local/lib/python3.12/site-packages (from aiohttp>=3.8->aiohttp-session==2.12.0) (25.3.0)
Requirement already satisfied: frozenlist>=1.1.1 in ./.local/lib/python3.12/site-packages (from aiohttp>=3.8->aiohttp-session==2.12.0) (1.5.0)
Requirement already satisfied: multidict<7.0,>=4.5 in ./.local/lib/python3.12/site-packages (from aiohttp>=3.8->aiohttp-session==2.12.0) (6.2.0)
Requirement already satisfied: yarl<2.0,>=1.0 in ./.local/lib/python3.12/site-packages (from aiohttp>=3.8->aiohttp-session==2.12.0) (1.18.3)
Requirement already satisfied: idna>=2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp>=3.8->aiohttp-session==2.12.0) (3.10)
Requirement already satisfied: propcache>=0.2.0 in ./.local/lib/python3.12/site-packages (from yarl<2.0,>=1.0->aiohttp>=3.8->aiohttp-session==2.12.0) (0.3.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: jinja2==3.1.2 in ./.local/lib/python3.12/site-packages (3.1.2)
Requirement already satisfied: MarkupSafe>=2.0 in ./.local/lib/python3.12/site-packages (from jinja2==3.1.2) (3.0.2)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: python-dotenv==1.0.1 in ./.local/lib/python3.12/site-packages (1.0.1)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: Pillow==10.3.0 in ./.local/lib/python3.12/site-packages (10.3.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: PyTZ==2024.1 in ./.local/lib/python3.12/site-packages (2024.1)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: typing_extensions==4.11.0 in ./.local/lib/python3.12/site-packages (4.11.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: jsonpickle==3.0.4 in ./.local/lib/python3.12/site-packages (3.0.4)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: regex==2024.5.15 in ./.local/lib/python3.12/site-packages (2024.5.15)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: pandas==2.2.2 in ./.local/lib/python3.12/site-packages (2.2.2)
Requirement already satisfied: numpy>=1.26.0 in ./.local/lib/python3.12/site-packages (from pandas==2.2.2) (2.2.4)
Requirement already satisfied: python-dateutil>=2.8.2 in ./.local/lib/python3.12/site-packages (from pandas==2.2.2) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in ./.local/lib/python3.12/site-packages (from pandas==2.2.2) (2024.1)
Requirement already satisfied: tzdata>=2022.7 in ./.local/lib/python3.12/site-packages (from pandas==2.2.2) (2025.1)
Requirement already satisfied: six>=1.5 in ./.local/lib/python3.12/site-packages (from python-dateutil>=2.8.2->pandas==2.2.2) (1.17.0)
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: apscheduler==3.10.4 in ./.local/lib/python3.12/site-packages (3.10.4)
Requirement already satisfied: six>=1.4.0 in ./.local/lib/python3.12/site-packages (from apscheduler==3.10.4) (1.17.0)
Requirement already satisfied: pytz in ./.local/lib/python3.12/site-packages (from apscheduler==3.10.4) (2024.1)
Requirement already satisfied: tzlocal!=3.*,>=2.0 in ./.local/lib/python3.12/site-packages (from apscheduler==3.10.4) (5.3.1)
2025-04-16 15:28:17,554 - __main__ - INFO - Starting main execution block (__name__ == '__main__')
2025-04-16 15:28:17,554 - __main__ - INFO - --- Entered main() ---
2025-04-16 15:28:17,554 - __main__ - INFO - Initializing BettingBot class...
2025-04-16 15:28:17,554 - bot.core - INFO - --- BettingBot __init__ START ---
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing DB Manager instance...
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Cache Manager instance...
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Command Tree...
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Game Service...
2025-04-16 15:28:17,555 - bot.services.game_service - INFO - GameService initialized.
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Voice Service...
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Bet Service...
2025-04-16 15:28:17,555 - bot.services.bet_service - INFO - BetService initialized.
2025-04-16 15:28:17,555 - bot.core - INFO - Initializing Web App variable...
2025-04-16 15:28:17,555 - bot.core - INFO - --- BettingBot __init__ END ---
2025-04-16 15:28:17,555 - __main__ - INFO - BettingBot instance created.
2025-04-16 15:28:17,555 - __main__ - INFO - Attempting to start bot...
2025-04-16 15:28:17,555 - discord.client - INFO - logging in using static token
2025-04-16 15:28:17,958 - bot.core - INFO - --- Running setup_hook ---
2025-04-16 15:28:17,958 - bot.core - INFO - STEP: Connecting to Database...
2025-04-16 15:28:17,958 - bot.data.db_manager - INFO - Attempting to connect to database 'customer_990306_Server_database' at na05-sql.pebblehost.com:3306
2025-04-16 15:28:17,969 - bot.data.db_manager - INFO - Database connection pool initialized successfully
2025-04-16 15:28:17,971 - bot.data.db_manager - INFO - All expected tables (bets, cappers, server_settings, subscribers, subscriptions, unit_records, users, user_images, voice_bet_updates) and server_settings.commands_registered column found in database 'customer_990306_Server_database'.
2025-04-16 15:28:17,971 - bot.core - INFO - STEP COMPLETE: Database connected.
2025-04-16 15:28:17,971 - bot.core - INFO - STEP: Connecting to Cache...
2025-04-16 15:28:17,971 - bot.data.cache_manager - INFO - Attempting to connect to Redis at redis-14768.c246.us-east-1-4.ec2.redns.redis-cloud.com:14768
2025-04-16 15:28:18,048 - bot.data.cache_manager - INFO - Redis connection initialized successfully
2025-04-16 15:28:18,048 - bot.core - INFO - STEP COMPLETE: Cache connected.
2025-04-16 15:28:18,048 - bot.core - INFO - STEP: Starting Game Service...
2025-04-16 15:28:18,049 - api.sports_api - INFO - Sports API client session started
2025-04-16 15:28:18,049 - bot.services.game_service - INFO - Fetching initial game data for pending bets...
2025-04-16 15:28:18,079 - bot.services.game_service - INFO - Initial game data fetching complete.
2025-04-16 15:28:18,080 - bot.services.game_service - INFO - Game service polling started.
2025-04-16 15:28:18,080 - bot.core - INFO - STEP: Starting Voice Service...
2025-04-16 15:28:18,080 - bot.services.voice_service - INFO - Voice service update loop started.
2025-04-16 15:28:18,080 - bot.services.voice_service - INFO - Monthly total update loop started.
2025-04-16 15:28:18,080 - bot.services.voice_service - INFO - Voice service started.
2025-04-16 15:28:18,080 - bot.core - INFO - STEP: Starting Bet Service (scheduler)...
2025-04-16 15:28:18,080 - bot.services.bet_service - INFO - Bet service starting (scheduler only).
2025-04-16 15:28:18,080 - bot.services.bet_service - INFO - Setting up APScheduler jobs for tallying.
2025-04-16 15:28:18,083 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-04-16 15:28:18,083 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-04-16 15:28:18,084 - apscheduler.scheduler - INFO - Added job "BetService.run_monthly_tally" to job store "default"
2025-04-16 15:28:18,084 - apscheduler.scheduler - INFO - Added job "BetService.run_yearly_tally" to job store "default"
2025-04-16 15:28:18,084 - apscheduler.scheduler - INFO - Scheduler started
2025-04-16 15:28:18,084 - bot.services.bet_service - INFO - APScheduler started successfully with tally jobs.
2025-04-16 15:28:18,084 - bot.services.bet_service - INFO - Bet service scheduler started.
2025-04-16 15:28:18,084 - bot.core - INFO - STEP COMPLETE: Bet Service scheduler started.
2025-04-16 15:28:18,084 - bot.core - INFO - STEP: Running startup reconciliation checks...
2025-04-16 15:28:18,084 - bot.tasks.startup_checks - INFO - Running startup checks (Logic Update 2025-04-15 v3 - FINAL)...
2025-04-16 15:28:18,084 - bot.tasks.startup_checks - INFO - Checking for pending bets (0/0) missing unit records (will insert units=0, total=0)...
2025-04-16 15:28:18,085 - bot.tasks.startup_checks - INFO - No pending bets (0/0) found missing unit records.
2025-04-16 15:28:18,217 - bot.tasks.startup_checks - INFO - Fetched guild 1328116926903353398 via API for bet 202504160544592
2025-04-16 15:28:18,319 - bot.tasks.startup_checks - INFO - Fetched channel 1328130555568455710 for bet 202504160544592
2025-04-16 15:28:18,488 - bot.tasks.startup_checks - INFO - Loaded 1 pending bets into memory. Created 0 missing placeholder unit records. Resolved 0 bets by reaction. Skipped 0 bets.
2025-04-16 15:28:18,489 - bot.tasks.startup_checks - INFO - Reconciling 'units' column for ALL resolved bets (Create if Missing, Update if Exists AND units=0)...
2025-04-16 15:28:18,490 - bot.tasks.startup_checks - INFO - Found 13 resolved bets to check/reconcile.
2025-04-16 15:28:18,496 - bot.tasks.startup_checks - INFO - Checked resolved unit records. Updated 0 entries where units were 0. Created 0 missing records for resolved bets.
2025-04-16 15:28:18,496 - bot.tasks.startup_checks - INFO - Startup checks completed.
2025-04-16 15:28:18,496 - bot.core - INFO - STEP COMPLETE: Startup reconciliation checks finished.
2025-04-16 15:28:18,496 - bot.core - INFO - STEP: Setting up web server...
2025-04-16 15:28:18,497 - web.server - INFO - Web application setup complete.
2025-04-16 15:28:18,497 - bot.core - INFO - STEP COMPLETE: Web server setup.
2025-04-16 15:28:18,497 - bot.core - INFO - STEP: Starting web server task...
2025-04-16 15:28:18,497 - bot.core - INFO - STEP COMPLETE: Web server task created.
2025-04-16 15:28:18,497 - bot.core - INFO - STEP: Loading ALL command definitions...
2025-04-16 15:28:18,497 - bot.core - INFO - --- Starting Command Loading ---
2025-04-16 15:28:18,497 - bot.core - INFO - Loading GLOBAL commands...
2025-04-16 15:28:18,513 - bot.core - INFO - Loaded and registered GLOBAL command: admin
2025-04-16 15:28:18,514 - bot.core - INFO - Loaded and registered GLOBAL command: subscription
2025-04-16 15:28:18,514 - bot.core - INFO - Loaded and registered GLOBAL command: help
2025-04-16 15:28:18,514 - bot.core - INFO - Loading GUILD command modules from commands/ folder (storing setup functions)...
2025-04-16 15:28:18,912 - bot.core - INFO - Stored setup function for GUILD command: leaderboard
2025-04-16 15:28:18,912 - bot.core - INFO - Stored setup function for GUILD command: show_cappers
2025-04-16 15:28:18,914 - bot.core - INFO - Stored setup function for GUILD command: profile
2025-04-16 15:28:18,915 - bot.core - INFO - Stored setup function for GUILD command: stats
2025-04-16 15:28:18,915 - bot.core - INFO - Stored setup function for GUILD command: load_url
2025-04-16 15:28:18,916 - bot.core - INFO - Stored setup function for GUILD command: load_logos
2025-04-16 15:28:18,916 - bot.core - INFO - Stored setup function for GUILD command: add_capper
2025-04-16 15:28:18,917 - bot.core - INFO - Stored setup function for GUILD command: setid
2025-04-16 15:28:18,917 - bot.core - INFO - Storing BetService command setup function...
2025-04-16 15:28:18,917 - bot.core - INFO - Stored setup function for BetService commands.
2025-04-16 15:28:18,917 - bot.core - INFO - Command loading process finished.
2025-04-16 15:28:18,917 - bot.core - INFO - Stored setup functions for GUILD commands: ['leaderboard', 'show_cappers', 'profile', 'stats', 'load_url', 'load_logos', 'add_capper', 'setid', 'bet_service']
2025-04-16 15:28:18,917 - bot.core - INFO - STEP COMPLETE: Command definitions loaded/stored.
2025-04-16 15:28:18,917 - bot.core - INFO - STEP: Syncing GLOBAL commands...
2025-04-16 15:28:18,918 - web.server - INFO - Web server started at http://0.0.0.0:25594/
2025-04-16 15:28:19,087 - bot.core - INFO - STEP COMPLETE: Global commands synced: ['admin', 'subscription', 'help']
2025-04-16 15:28:19,087 - bot.core - INFO - STEP: Fetching configured guilds for command registration...
2025-04-16 15:28:19,087 - bot.core - INFO - Found 1 guilds marked as configured: [1328116926903353398]
2025-04-16 15:28:19,087 - bot.core - INFO - STEP: Registering and syncing GUILD commands for configured guilds...
2025-04-16 15:28:19,088 - bot.core - INFO - --- Registering GUILD commands for Guild ID: 1328116926903353398 ---
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'leaderboard' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'show_cappers' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'profile' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'stats' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'load_url' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.commands.load_logos - INFO - Registering /load_logos command globally.
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'load_logos' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'add_capper' in guild 1328116926903353398 (without guild param - fallback).
2025-04-16 15:28:19,088 - bot.commands.setid - INFO - Registered /setid command guild 1328116926903353398.
2025-04-16 15:28:19,088 - bot.core - INFO - Successfully called setup for 'setid' in guild 1328116926903353398 (with guild param).
2025-04-16 15:28:19,089 - bot.services.bet_service - INFO - BetService commands (/bet, /edit_units, /cancel_bet) added to tree for guild 1328116926903353398
2025-04-16 15:28:19,089 - bot.core - INFO - Successfully called setup for BetService commands in guild 1328116926903353398.
2025-04-16 15:28:19,089 - bot.core - INFO - Attempting to sync all registered commands for guild 1328116926903353398...
2025-04-16 15:28:19,227 - bot.core - INFO - Successfully synced commands for guild 1328116926903353398. Synced: ['setid', 'bet', 'edit_units', 'cancel_bet']
2025-04-16 15:28:19,227 - bot.core - INFO - --- Finished attempting GUILD command registration for Guild ID: 1328116926903353398 ---
2025-04-16 15:28:19,228 - bot.core - INFO - STEP COMPLETE: Finished attempting registration & sync for all configured guilds.
2025-04-16 15:28:19,228 - bot.core - INFO - END: setup_hook completed successfully.
2025-04-16 15:28:19,423 - discord.gateway - INFO - Shard ID None has connected to Gateway (Session ID: c42c8a0f0fa4a2881d6ff08b8a559392).
2025-04-16 15:28:21,430 - bot.services.game_service - INFO - GameService poll loop starting after bot ready.
2025-04-16 15:28:21,430 - bot.services.voice_service - INFO - Voice service entering update loop.
2025-04-16 15:28:21,430 - bot.services.voice_service - INFO - Monthly total update loop started.
2025-04-16 15:28:21,430 - bot.core - INFO - Logged in as Bet Embed Generator (ID: 1341993312915034153)
2025-04-16 15:28:21,430 - bot.core - INFO - Discord.py version: 2.3.2
2025-04-16 15:28:21,430 - bot.core - INFO - Bot is ready and online.
2025-04-16 15:28:26,435 - bot.services.game_service - INFO - Polling: No active leagues with pending bets found. Sleeping.
2025-04-16 15:28:38,947 - bot.services.admin_handler - INFO - Admin handler invoked by ghilliestew (ID: 761388542965448767) in guild 1328126227013439601
2025-04-16 15:28:39,344 - bot.services.admin_handler - INFO - Admin settings view sent to 761388542965448767 in 1328126227013439601
2025-04-16 15:29:19,355 - bot.services.admin_handler - INFO - Saving CHANNELS settings via save_guild_settings...
2025-04-16 15:29:19,356 - bot.services.admin_handler - INFO - Guild 1328126227013439601 settings successfully updated/inserted in DB.
2025-04-16 15:29:19,356 - bot.services.admin_handler - INFO - Settings saved for 1328126227013439601. Marking configured & registering commands.
2025-04-16 15:29:19,357 - bot.services.admin_handler - INFO - Marked guild 1328126227013439601 configured. Registering commands...
2025-04-16 15:29:19,357 - bot.core - INFO - --- Registering GUILD commands for Guild ID: 1328126227013439601 ---
2025-04-16 15:29:19,357 - bot.core - ERROR - Error calling setup fallback for 'leaderboard' in guild 1328126227013439601: Command 'leaderboard' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/leaderboard.py", line 12, in setup
    tree.add_command(leaderboard_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'leaderboard' already registered.
2025-04-16 15:29:19,359 - bot.core - ERROR - Error calling setup fallback for 'show_cappers' in guild 1328126227013439601: Command 'show_cappers' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/show_cappers.py", line 12, in setup
    tree.add_command(show_cappers_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'show_cappers' already registered.
2025-04-16 15:29:19,360 - bot.core - ERROR - Error calling setup fallback for 'profile' in guild 1328126227013439601: Command 'profile' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/profile.py", line 22, in setup
    tree.add_command(profile_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'profile' already registered.
2025-04-16 15:29:19,361 - bot.core - ERROR - Error calling setup fallback for 'stats' in guild 1328126227013439601: Command 'stats' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/stats.py", line 13, in setup
    tree.add_command(stats_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'stats' already registered.
2025-04-16 15:29:19,362 - bot.core - ERROR - Error calling setup fallback for 'load_url' in guild 1328126227013439601: Command 'load_url' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/load_url.py", line 13, in setup
    tree.add_command(load_url_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'load_url' already registered.
2025-04-16 15:29:19,362 - bot.commands.load_logos - INFO - Registering /load_logos command globally.
2025-04-16 15:29:19,362 - bot.core - ERROR - Error calling setup fallback for 'load_logos' in guild 1328126227013439601: Command 'load_logos' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/load_logos.py", line 39, in setup
    tree.add_command(load_logos)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'load_logos' already registered.
2025-04-16 15:29:19,363 - bot.core - ERROR - Error calling setup fallback for 'add_capper' in guild 1328126227013439601: Command 'add_capper' already registered.
Traceback (most recent call last):
  File "/home/container/bot/core.py", line 194, in register_guild_commands
    result = setup_func(self.command_tree, guild=guild_object)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: setup() got an unexpected keyword argument 'guild'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/container/bot/core.py", line 200, in register_guild_commands
    result = setup_func(self.command_tree)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/commands/add_capper.py", line 12, in setup
    tree.add_command(add_capper_command)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 373, in add_command
    raise CommandAlreadyRegistered(name, None)
discord.app_commands.errors.CommandAlreadyRegistered: Command 'add_capper' already registered.
2025-04-16 15:29:19,364 - bot.commands.setid - INFO - Registered /setid command guild 1328126227013439601.
2025-04-16 15:29:19,364 - bot.core - INFO - Successfully called setup for 'setid' in guild 1328126227013439601 (with guild param).
2025-04-16 15:29:19,364 - bot.services.bet_service - INFO - BetService commands (/bet, /edit_units, /cancel_bet) added to tree for guild 1328126227013439601
2025-04-16 15:29:19,364 - bot.core - INFO - Successfully called setup for BetService commands in guild 1328126227013439601.
2025-04-16 15:29:19,364 - bot.core - INFO - Attempting to sync all registered commands for guild 1328126227013439601...
2025-04-16 15:29:19,496 - bot.core - INFO - Successfully synced commands for guild 1328126227013439601. Synced: ['setid', 'bet', 'edit_units', 'cancel_bet']
2025-04-16 15:29:19,496 - bot.core - INFO - --- Finished attempting GUILD command registration for Guild ID: 1328126227013439601 ---
2025-04-16 15:29:19,496 - bot.services.admin_handler - INFO - Triggered command registration for 1328126227013439601.
2025-04-16 15:29:19,497 - bot.services.admin_handler - INFO - Followup for 1328126227013439601: Channels settings updated successfully! Guild-specific commands registered/updated.
2025-04-16 15:29:28,506 - bot.services.admin_handler - INFO - Saving ROLES settings via save_guild_settings...
2025-04-16 15:29:28,506 - bot.services.admin_handler - INFO - Settings saved for 1328126227013439601. Marking configured & registering commands.
2025-04-16 15:29:28,507 - bot.services.admin_handler - ERROR - Failed mark guild 1328126227013439601 configured in DB.
2025-04-16 15:29:28,507 - bot.services.admin_handler - INFO - Followup for 1328126227013439601: Roles settings updated successfully! Error registering guild commands. Check logs.
2025-04-16 15:29:34,744 - bot.services.admin_handler - INFO - Guild 1328126227013439601 settings successfully updated/inserted in DB.
2025-04-16 15:30:00,438 - bot.services.voice_service - INFO - Voice service starting synchronized update cycle.
2025-04-16 15:30:00,439 - data.db_manager - WARNING - Database pool closed or not initialized. Attempting to reconnect.
2025-04-16 15:30:00,439 - data.db_manager - INFO - Attempting to connect to database 'customer_990306_Server_database' at na05-sql.pebblehost.com:3306
2025-04-16 15:30:00,464 - data.db_manager - INFO - Database connection pool initialized successfully
2025-04-16 15:30:00,465 - data.db_manager - INFO - All expected tables (bets, cappers, server_settings, subscribers, subscriptions, unit_records, users, user_images, voice_bet_updates) and server_settings.commands_registered column found in database 'customer_990306_Server_database'.
2025-04-16 15:30:00,466 - bot.services.voice_service - INFO - Guild 1328116926903353398 subscription_status: Paid, premium: True
2025-04-16 15:30:00,467 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-01. Skipping total update.
2025-04-16 15:30:00,467 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-02. Skipping total update.
2025-04-16 15:30:00,468 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-03. Skipping total update.
2025-04-16 15:30:00,471 - bot.services.voice_service - INFO - Guild 1328126227013439601 subscription_status: Paid, premium: True
2025-04-16 15:30:00,471 - bot.services.voice_service - WARNING - No unit_records found for guild 1328126227013439601 in 2025-01. Skipping total update.
2025-04-16 15:30:00,474 - bot.services.voice_service - INFO - Voice service update cycle finished.
2025-04-16 15:30:02,027 - discord.app_commands.tree - ERROR - Ignoring exception in command 'bet'
Traceback (most recent call last):
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/commands.py", line 828, in _do_call
    return await self._callback(interaction, **params)  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/bot/services/bet_service.py", line 1441, in bet_cmd_wrapper
    await bet_command_interaction(interaction, bet_service_instance)
          ^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'bet_command_interaction' is not defined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/tree.py", line 1248, in _call
    await command._invoke_with_namespace(interaction, namespace)
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/commands.py", line 853, in _invoke_with_namespace
    return await self._do_call(interaction, transformed_values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/container/.local/lib/python3.12/site-packages/discord/app_commands/commands.py", line 846, in _do_call
    raise CommandInvokeError(self, e) from e
discord.app_commands.errors.CommandInvokeError: Command 'bet' raised an exception: NameError: name 'bet_command_interaction' is not defined
2025-04-16 15:30:31,352 - bot.commands.setid - INFO - Processing /setid for user 761388542965448767 in guild 1328126227013439601
2025-04-16 15:30:31,352 - bot.services.setid_handler - INFO - Processing /setid for user 761388542965448767 in guild 1328126227013439601
2025-04-16 15:30:31,667 - bot.services.setid_handler - INFO - Saved profile image for user 761388542965448767 to /home/container/bot/static/user_images/761388542965448767_1328126227013439601_1744846231.jpg
2025-04-16 15:30:33,628 - bot.services.setid_handler - WARNING - Could not edit button message for user 761388542965448767: Message not found
2025-04-16 15:30:44,352 - bot.services.setid_handler - INFO - Modal submitted by user 761388542965448767 in guild 1328126227013439601
2025-04-16 15:30:44,580 - bot.services.setid_handler - INFO - Updated capper row for user 761388542965448767 in guild 1328126227013439601. Rows affected: 1
2025-04-16 15:33:26,443 - bot.services.game_service - INFO - Polling: No active leagues with pending bets found. Sleeping.
2025-04-16 15:33:39,461 - bot.commands.setid - INFO - Processing /setid for user 761388542965448767 in guild 1328116926903353398
2025-04-16 15:33:39,461 - bot.services.setid_handler - INFO - Processing /setid for user 761388542965448767 in guild 1328116926903353398
2025-04-16 15:33:39,816 - bot.services.setid_handler - INFO - Saved profile image for user 761388542965448767 to /home/container/bot/static/user_images/761388542965448767_1328116926903353398_1744846419.jpg
2025-04-16 15:33:41,540 - bot.services.setid_handler - WARNING - Could not edit button message for user 761388542965448767: Message not found
2025-04-16 15:33:55,324 - bot.services.setid_handler - INFO - Modal submitted by user 761388542965448767 in guild 1328116926903353398
2025-04-16 15:33:55,474 - bot.services.setid_handler - INFO - Inserted new capper row for user 761388542965448767 in guild 1328116926903353398. Rows affected: 1
2025-04-16 15:35:00,494 - bot.services.voice_service - INFO - Voice service starting synchronized update cycle.
2025-04-16 15:35:00,495 - bot.services.voice_service - INFO - Guild 1328116926903353398 subscription_status: Paid, premium: True
2025-04-16 15:35:00,495 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-01. Skipping total update.
2025-04-16 15:35:00,496 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-02. Skipping total update.
2025-04-16 15:35:00,496 - bot.services.voice_service - WARNING - No unit_records found for guild 1328116926903353398 in 2025-03. Skipping total update.
2025-04-16 15:35:00,500 - bot.services.voice_service - INFO - Guild 1328126227013439601 subscription_status: Paid, premium: True
2025-04-16 15:35:00,501 - bot.services.voice_service - WARNING - No unit_records found for guild 1328126227013439601 in 2025-01. Skipping total update.
2025-04-16 15:35:00,505 - bot.services.voice_service - INFO - Voice service update cycle finished.
